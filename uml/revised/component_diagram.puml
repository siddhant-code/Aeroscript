@startuml Component Diagram
!theme plain

package "Build System" {
  component [CMake] as CMAKE
  component [colcon] as COLCON
}

package "drone_orchestrator" {
  component [Orchestrator Library] as ORCH_LIB
  interface "Orchestrator API" as ORCH_API
  component [Unit Tests] as ORCH_TEST
}

package "drone_controller" {
  component [mavic_controller\nExecutable] as CONTROLLER
  component [Integration Tests] as INT_TEST
  component [Helper Functions Test] as HELPER_TEST
  component [CSV Config] as CSV_CONFIG
}

package "mavic_simulation" {
  component [MavicDriver\n(C++ Plugin)] as DRIVER
  component [robot_launch.py] as LAUNCH
  component [URDF Model] as URDF
  component [World Generator] as WORLD_GEN
}

package "ROS2 Infrastructure" {
  component [ROS2 DDS] as DDS
  database "Topics" {
    [GPS Topics\n/Mavic_2_PRO_*/gps] as GPS_TOPIC
    [Velocity Topics\n/Mavic_2_PRO_*/gps/speed_vector] as VEL_TOPIC
    [Command Topics\n/Mavic_2_PRO_*/cmd_vel] as CMD_TOPIC
  }
  component [ROS2 Parameters] as PARAMS
  component [ROS2 Bag Recorder] as BAG_REC
}

package "Simulation" {
  component [Webots] as WEBOTS
}

ORCH_LIB ..> ORCH_API : provides
CONTROLLER --> ORCH_API : uses
CONTROLLER --> GPS_TOPIC : subscribes
CONTROLLER --> VEL_TOPIC : subscribes
CONTROLLER --> CMD_TOPIC : publishes
CONTROLLER --> CSV_CONFIG : reads
CONTROLLER --> PARAMS : reads
DRIVER --> CMD_TOPIC : subscribes
DRIVER --> GPS_TOPIC : publishes
DRIVER --> VEL_TOPIC : publishes
DRIVER --> WEBOTS : controls
LAUNCH --> DRIVER : launches
LAUNCH --> WEBOTS : launches
LAUNCH --> WORLD_GEN : uses
LAUNCH --> BAG_REC : optionally starts
LAUNCH --> CONTROLLER : launches
URDF --> WEBOTS : defines model

ORCH_TEST --> ORCH_LIB : tests
INT_TEST --> CONTROLLER : tests
HELPER_TEST --> CSV_CONFIG : tests

CMAKE --> ORCH_LIB : builds
COLCON --> CONTROLLER : builds
COLCON --> DRIVER : builds

DDS --> GPS_TOPIC : manages
DDS --> VEL_TOPIC : manages
DDS --> CMD_TOPIC : manages
DDS --> PARAMS : manages

note right of ORCH_LIB
  Stand-alone C++ library
  Uses RVO3D for path planning
  No ROS2 dependencies
end note

note right of CONTROLLER
  Main control node
  Coordinates multiple drones
  Handles letter writing sequence
  Reads CSV file for waypoints
  Uses ROS2 parameters for configuration
end note

note right of DRIVER
  C++ Webots plugin
  Controls individual drone
  Reads sensors, controls propellers
  Implements PID control
end note

note right of LAUNCH
  Python launch file
  Generates world dynamically
  Supports launch arguments:
  - text (default: "HEY")
  - record_bag (default: false)
  - bag_name (default: "aeroscript_bag")
  - world (default: "updated_world.wbt")
end note

note right of BAG_REC
  Optional ROS2 bag recording
  Records all topics except:
  - camera topics
  - compass topics
  Saves to results/ directory
end note

@enduml

